@using ZkData
@using ZeroKWeb
@model IQueryable<Clan>
@{
  Page.Title = "List of PlanetWars clans";
}
<script type="text/javascript" language="javascript">
  $(document).ready(function () {
    $('#clanTable').tablesorter();
  }); 
</script>
<div>
To take active part in <a href='@Url.Action("Index","Planetwars")'>PlanetWars</a> join a clan. <br />
Clan you join or create <b>cannot be changed</b> for the duration of planetwars galaxy, so pick carefully!<br />
You can also @Html.ActionLink("create new clan", "CreateClan", "Planetwars")
</div>


<table id="clanTable" class="tablesorter">
  <thead style="cursor:pointer">
    <tr>
      <th>Full name</th>
      <th>
        Tag
      </th>
      <th>
        Influence
      </th>
      <th>
        Leader
      </th>
      <th>
        Members
      </th>
      <th>Elo (avg)</th>
      <th>Level (med)</th>
      <th>
        Can join?
      </th>
    </tr>
  </thead>
  <tbody>

  @foreach (var c in Model) {
    <tr>
    <td><a href='@Url.Action("Clan", new {id= c.ClanID})'><img src='@c.GetImageUrl()' />@c.ClanName</a></td>
      <td>@Html.PrintClan(c)</td>
      <td>@c.Accounts.SelectMany(x=>x.AccountPlanets).Sum(x=>(int?)x.Influence)</td>
      <td>@Html.PrintAccount(c.Accounts.Single(x=>x.IsClanFounder))</td>
      <td>@c.Accounts.Count()</td>
      <td>@Math.Round(c.Accounts.Average(x=>x.Elo))</td>
      <td>@c.Accounts.OrderBy(x=>x.Level).Skip(c.Accounts.Count()/2).First().Level</td>
      @if (c.CanJoin(Global.Account)) {
        <td>@Html.ActionLink("Join now!", "JoinClan", new { id = c.ClanID }, new {@class="delete"}) @(string.IsNullOrEmpty(c.Password) ? "" :"password")</td>
      } else {
        <td>No</td>
      }
      
    </tr>
   }
   </tbody>
</table>
