@using ZkData
@model Planet
<table>
    @{
        var spread = Model.PlanetStructures.Where(x => x.IsActive).Sum(x => x.StructureType.EffectInfluenceSpread);

        var dropshipCapa = Model.PlanetStructures.Where(x => x.IsActive).Sum(x => x.StructureType.EffectDropshipCapacity);
        var dropshipProd = Model.PlanetStructures.Where(x => x.IsActive).Sum(x => x.StructureType.EffectDropshipProduction);
        var defense = Model.PlanetStructures.Where(x => x.IsActive).Sum(x => x.StructureType.EffectInfluenceDefense);
        var bombDefense = Model.PlanetStructures.Where(x => x.IsActive).Sum(x => x.StructureType.EffectBomberDefense);
        var dropDefense = Model.PlanetStructures.Where(x => x.IsActive).Sum(x => x.StructureType.EffectDropshipDefense);
        var warpProd = Model.PlanetStructures.Where(x => x.IsActive).Sum(x => x.StructureType.EffectWarpProduction);
        var victory = Model.PlanetStructures.Where(x => x.IsActive).Any(x => x.StructureType.EffectIsVictoryPlanet == true);
        var aliens = Model.PlanetStructures.Where(x => x.IsActive).Select(x => x.StructureType.EffectBots).Where(x => !string.IsNullOrEmpty(x)).FirstOrDefault();
        var techs = Model.PlanetStructures.Where(x => x.IsActive).Select(x => x.StructureType.Unlock).Where(x => x != null).ToList();
        var upkeep = Model.GetUpkeepCost();

        <tr>
            <td>Governor:</td>
            <td>@Html.PrintAccount(Model.Account)  @Html.PrintClan(Model.Account != null ? Model.Account.Clan : null)</td>
        </tr>
        <tr>
            <td>Bonuses:</td>
            <td><span style='color: @(spread == 0 ? "red" : "")'>@spread</span> influence spread bonus
                @if (defense > 0)
                {
                    @:, <span style='color: red'>+@defense influence</span>
                }
                @if (dropDefense > 0)
                {
                    @:, <span style='color: red'>+@bombDefense bomber defense</span>
                }                
                @if (dropDefense > 0)
                {
                    @:, <span style='color: red'>+@dropDefense ship defense</span>
                }
                @if (upkeep > 0) {
                    @:, <span style='color: red' title='Most structures need 2% of their cost/turn as upkeep'>-@(upkeep) upkeep/turn</span>
                }    
                @if (techs.Any())
                {
                    foreach (var t in techs)
                    {
                        @:, <span title='$unlock$@t.UnlockID' style='color:@t.LabelColor; white-space: nowrap;' ><img src='@t.ImageUrl' width='20'/>@t.Name</span>
                    }
                }
                @if (warpProd > 0)
                {
                    @:, +@warpProd warp cores
                }
                @if (dropshipProd > 0)
                {
                    @:, +@dropshipProd ships/turn
                }
                @if (dropshipCapa > 0)
                {
                    @:, +@dropshipCapa starfleet capacity
                }
                @if (victory)
                {
                    @:, @(victory ? "ARTEFACT!" : "")
                }
                @if (!string.IsNullOrEmpty(aliens))
                {
                    @:, @aliens
                }
            </td>
        </tr> }
</table>
